<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
	<meta name="generator" content="Hugo 0.86.0" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      discrete blogarithm &middot; 
    
  </title>

  
  <link rel="stylesheet" href="https://blog.azuki.vip/css/poole.css">
  <link rel="stylesheet" href="https://blog.azuki.vip/css/syntax.css">
  <link rel="stylesheet" href="https://blog.azuki.vip/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://blog.azuki.vip/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="https://blog.azuki.vip/assets/favicon.ico">

  
  <link rel="alternate" type="application/rss+xml" title="RSS" href="https://blog.azuki.vip/atom.xml">
</head>


  <body>

    
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>
      yan&rsquo;s blog
    </p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item  active " href="https://blog.azuki.vip/">Home</a>
    <a class="sidebar-nav-item " href="https://blog.azuki.vip/post">Posts</a>
    <a class="sidebar-nav-item " href="https://blog.azuki.vip/about/">About</a>
      </nav>

  <div class="sidebar-item">
    <p>&copy; 2021. All rights reserved.</p>
  </div>
</div>


    
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="https://blog.azuki.vip/" title="Home">discrete blogarithm</a>
            <small></small>
          </h3>
        </div>
      </div>

      <div class="container content">





<div class="posts">
  
    <div class="post">
        <h1 class="post-title"><a href="https://blog.azuki.vip/wordpress-fail/">don’t forget to secure cookies ppl</a></h1>
        <span class="post-date">May 23, 2014</span>
        <p>Update (5/28/14): Regrettably, most of the stories covering this blog post have been all “OMG EVERYTHING IS BROKEN” rather than “Here’s how to make things better til WordPress rolls out a fix” (which I humbly believe will take a while to *fully* fix, given that their SSL support is so patchy). So, given that most people reading this are probably coming from one of those articles, I think it’s important to start with the actionable items that people can do to mitigate cookie-hijacking attacks on WordPress:</p>
<ol>
<li>If you’re a developer running your own WordPress install, make sure you set up SSL on all relevant servers and configure WordPress to auth flag cookies as “secure.”</li>
<li>If you’re a WordPress user, don’t be logged into WordPress on an untrusted network, or use a VPN. If you are and you visit a wordpress.com site (which confusingly may not actually have a wordpress.com domain name), your auth cookies are exposed.</li>
<li>[Experimental, probably not recommended] You can manually set the “secure” flag on the WP auth cookies in your browser. There’s no guarantee that this works consistently, since the server can always send a set-cookie that reverts it into an insecure cookie. It may cause some WP functionality to break.</li>
<li>If you suspect that your WP cookie may have been stolen in the past, you can invalidate it by (1) waiting 3 years for it to expire on the server or (2) resetting your wordpress.com password. Note that logging out of WordPress does *not* invalidate the cookie on the server, so someone who stole it can use it even after you’ve logged out. I verified that resetting your WP password does invalidate the old cookie; there may be other ways, but I haven’t found any.</li>
</ol>
<p>Original post below.</p>
<p> </p>
<p>While hunting down a bug report for <a href="https://github.com/EFForg/privacybadgerfirefox">Privacy Badger</a>, I noticed the “wordpress_logged_in” cookie being sent over clear HTTP to a WordPress authentication endpoint (<a href="http://r-login.wordpress.com/remote-login.php">http://r-login.wordpress.com/remote-login.php</a>) on someone’s blog.</p>
<div id="attachment_377" style="width: 904px" class="wp-caption alignnone">
  <a href="https://zyan.scripts.mit.edu/blog/wp-content/uploads/2014/05/wordpress_cookies.png"><img class="size-full wp-image-377" src="https://zyan.scripts.mit.edu/blog/wp-content/uploads/2014/05/wordpress_cookies.png" alt="uh-oh" width="894" height="864" srcset="https://zyan.scripts.mit.edu/blog/wp-content/uploads/2014/05/wordpress_cookies.png 894w, https://zyan.scripts.mit.edu/blog/wp-content/uploads/2014/05/wordpress_cookies-300x289.png 300w, https://zyan.scripts.mit.edu/blog/wp-content/uploads/2014/05/wordpress_cookies-624x603.png 624w" sizes="(max-width: 894px) 100vw, 894px" /></a>
  <p class="wp-caption-text">
    uh-oh
  </p>
</div>
<p>Sounds like bad news! As mom always said, you should set the “secure” flag on sensitive cookies so that they’re never sent in plaintext.</p>
<p>To check whether this cookie did anything interesting, I logged out of my wordpress account, copied the wordpress_logged_in cookie into a fresh browser profile, and visited <a href="http://wordpress.com">http://wordpress.com</a> in the new browser profile. Yep, I was logged in!</p>
<p>This wouldn’t be so bad if the wordpress_logged_in cookie were invalidated when the original user logged out or logged back in, but it definitely still worked. Does it expire? In 3 years. (Not sure when it gets invalidated on the server side, haven’t waited long enough to know.)</p>
<p>Is this as bad as sending username/password in plaintext? I tried to see if I could reset the original user’s password.</p>
<p><a href="https://zyan.scripts.mit.edu/blog/wp-content/uploads/2014/05/wordpresspassword1-e1400805127825.png"><img class="alignnone size-full wp-image-378" src="https://zyan.scripts.mit.edu/blog/wp-content/uploads/2014/05/wordpresspassword1-e1400805127825.png" alt="wordpresspassword1" width="992" height="428" srcset="https://zyan.scripts.mit.edu/blog/wp-content/uploads/2014/05/wordpresspassword1-e1400805127825.png 992w, https://zyan.scripts.mit.edu/blog/wp-content/uploads/2014/05/wordpresspassword1-e1400805127825-300x129.png 300w, https://zyan.scripts.mit.edu/blog/wp-content/uploads/2014/05/wordpresspassword1-e1400805127825-624x269.png 624w" sizes="(max-width: 992px) 100vw, 992px" /></a></p>
<p>That didn’t work, so I’m assuming WordPress uses the actually-secure cookie (wordpress_sec) for super important operations like password change. Nice job, but . . .</p>
<p>It turns out I could post to the original user’s blog (and create new blog sites on their behalf):</p>
<p><a href="https://zyan.scripts.mit.edu/blog/wp-content/uploads/2014/05/wordpress_postblog-e1400805350246.png"><img class="alignnone size-full wp-image-379" src="https://zyan.scripts.mit.edu/blog/wp-content/uploads/2014/05/wordpress_postblog-e1400805350246.png" alt="wordpress_postblog" width="928" height="581" srcset="https://zyan.scripts.mit.edu/blog/wp-content/uploads/2014/05/wordpress_postblog-e1400805350246.png 928w, https://zyan.scripts.mit.edu/blog/wp-content/uploads/2014/05/wordpress_postblog-e1400805350246-300x187.png 300w, https://zyan.scripts.mit.edu/blog/wp-content/uploads/2014/05/wordpress_postblog-e1400805350246-624x390.png 624w" sizes="(max-width: 928px) 100vw, 928px" /></a></p>
<p>I could see private posts:</p>
<p><a href="https://zyan.scripts.mit.edu/blog/wp-content/uploads/2014/05/wordpress_postsecretblog-e1400805413834.png"><img class="alignnone size-full wp-image-380" src="https://zyan.scripts.mit.edu/blog/wp-content/uploads/2014/05/wordpress_postsecretblog-e1400805413834.png" alt="wordpress_postsecretblog" width="950" height="523" srcset="https://zyan.scripts.mit.edu/blog/wp-content/uploads/2014/05/wordpress_postsecretblog-e1400805413834.png 950w, https://zyan.scripts.mit.edu/blog/wp-content/uploads/2014/05/wordpress_postsecretblog-e1400805413834-300x165.png 300w, https://zyan.scripts.mit.edu/blog/wp-content/uploads/2014/05/wordpress_postsecretblog-e1400805413834-624x343.png 624w" sizes="(max-width: 950px) 100vw, 950px" /></a></p>
<p>I could post comments on other blogs as them:</p>
<p><a href="https://zyan.scripts.mit.edu/blog/wp-content/uploads/2014/05/wordpress_postcomment-e1400805499342.png"><img class="alignnone size-full wp-image-381" src="https://zyan.scripts.mit.edu/blog/wp-content/uploads/2014/05/wordpress_postcomment-e1400805499342.png" alt="wordpress_postcomment" width="1007" height="534" srcset="https://zyan.scripts.mit.edu/blog/wp-content/uploads/2014/05/wordpress_postcomment-e1400805499342.png 1007w, https://zyan.scripts.mit.edu/blog/wp-content/uploads/2014/05/wordpress_postcomment-e1400805499342-300x159.png 300w, https://zyan.scripts.mit.edu/blog/wp-content/uploads/2014/05/wordpress_postcomment-e1400805499342-624x330.png 624w" sizes="(max-width: 1007px) 100vw, 1007px" /></a></p>
<p>I could see their blog stats:</p>
<p><a href="https://zyan.scripts.mit.edu/blog/wp-content/uploads/2014/05/wordpress_stats-e1400805571221.png"><img class="alignnone size-full wp-image-382" src="https://zyan.scripts.mit.edu/blog/wp-content/uploads/2014/05/wordpress_stats-e1400805571221.png" alt="wordpress_stats" width="1042" height="695" srcset="https://zyan.scripts.mit.edu/blog/wp-content/uploads/2014/05/wordpress_stats-e1400805571221.png 1042w, https://zyan.scripts.mit.edu/blog/wp-content/uploads/2014/05/wordpress_stats-e1400805571221-300x200.png 300w, https://zyan.scripts.mit.edu/blog/wp-content/uploads/2014/05/wordpress_stats-e1400805571221-1024x682.png 1024w, https://zyan.scripts.mit.edu/blog/wp-content/uploads/2014/05/wordpress_stats-e1400805571221-624x416.png 624w" sizes="(max-width: 1042px) 100vw, 1042px" /></a></p>
<p>And so forth. I couldn’t do some blog administrator tasks that required logging in again with the username/password, but still, not bad for a single cookie.</p>
<p>Moral of the story: don’t visit a WordPress site while logged into your account on an untrusted local network.</p>
<p>Update: Thanks to Andrew Nacin of WordPress for informing me that auth cookies will be invalidated after a session ends in the next WordPress release and that SSL support on WordPress will be improving!</p>
<p>Update (5/26/14): I subsequently found that the insecure cookie could be used to set someone’s 2fac auth device if they hadn’t set it, thereby locking them out of their account. If someone has set up 2fac already, the attacker can still bypass login auth by cookie stealing – the 2fac auth cookie is also sent over plaintext.</p>
<p>Update (5/26/14): A couple people have asked about whether the disclosure timeline below is reasonable, and my response is <a href="https://zyan.scripts.mit.edu/blog/wordpress-fail/#comment-70">here</a>.</p>
<p>Disclosure timeline:</p>
<p>Wed, 21 May 2014 16:12:17 PST: Reported issue to <a href="mailto:security@automattic.com">security@automattic.com</a>, per the instructions at <a href="http://make.wordpress.org/core/handbook/reporting-security-vulnerabilities/#where-do-i-report-security-issues;">http://make.wordpress.org/core/handbook/reporting-security-vulnerabilities/#where-do-i-report-security-issues;</a> at this point, the report was mostly out of courtesy, since I figured it had to be obvious to them and many WP users already that the login cookie wasn’t secured (it’s just a simple config setting in WordPress to turn on the secure cookie flag, as I understand it). Received no indication that the email was received.</p>
<p>22 May 2014 16:43: Mentioned the lack of cookie securing publicly. <a href="https://twitter.com/bcrypt/status/469624500850802688">https://twitter.com/bcrypt/status/469624500850802688</a></p>
<p>22 May 2014 17:39: Received response from Andrew Nacin (not regarding lack of cookie securing but rather that the auth cookie lifetime will soon be that of a regular session cookie). <a href="https://twitter.com/nacin/status/469638591614693376">https://twitter.com/nacin/status/469638591614693376</a></p>
<p>23 May 2014 ~13:00: Discovered two-factor auth issue on accident, reported to both <a href="mailto:security@automattic.com">security@automattic.com</a> and <a href="mailto:security@wordpress.org">security@wordpress.org</a> in reply to original email. I also mentioned it to Dan Goodin since I found the bug while trying to answer a question he had about cookies, but I did not disclose publicly.</p>
<p>25 May 2014 15:20: Received email response from <a href="mailto:security@automattic.com">security@automattic.com</a> saying that they were looking into it internally (no mention of timeline). Wrote back to say thanks.</p>
<p>26 May 2014, ~10:00: Ars Technica article about this gets published, which mentioned the 2-fac auth issue. I updated this blog post to reflect that.</p>
<p>26-27 May 2014: Some commenters on the Ars Technica article discover an arguably worse bug than the one that the original article was about: WordPress sends the login form over HTTP. (Even though the form POST is over HTTPS, the local network attacker can modify the target on the HTTP page however he/she wants and then it’s game over.) This wouldn’t be so bad if everyone used a password manager and changed passwords semi-regularly, since most people are likely to login to WordPress through their blog’s admin portal (which is always HTTPS as far as I can tell), except that password reuse is rampant. Robert Graham subsequently published <a href="http://blog.erratasec.com/2014/05/wordpress-unsafe-at-any-speed.html">this blog post</a>.</p>
<p>29 May 2014, 5:52: Received reply from WordPress saying they would email me again when fixed.</p>
<p>30 May 2014, 14:51: Andrew Nacin says all issues are supposedly fixed.</p>

    </div>
  
    <div class="post">
        <h1 class="post-title"><a href="https://blog.azuki.vip/some-heartbleed-tips/">How to make a less-leaky Heartbleed bandage</a></h1>
        <span class="post-date">Apr 10, 2014</span>
        <p>Mashable just put out a nice-looking chart showing “<a href="http://mashable.com/2014/04/09/heartbleed-bug-websites-affected/" target="_blank">Passwords You Need to Change Right Now</a>” change in light of the recent <a href="http://heartbleed.com" target="_blank">Heartbleed</a> carnage. However, it has some serious caveats that I wanted to mention:</p>
<ol>
<li>It’s probably better to be suspicious of companies whose statements are in present-tense (ex: “We have multiple protections” or even “We were not using OpenSSL”). The vulnerability existed since 2011, so even if a service was protected at the time of its disclosure 3 days ago, it could be have been affected at some point long before then. I am also skeptical that every single company on the list successfully made sure that nothing that they’ve used or given sensitive user data to had a vulnerable version of OpenSSL in the last 2 years.</li>
<li>The article neglects to mention that password reuse means you might have to change passwords on several services for every one that was leaked. The same goes for the fact that one can trigger password resets on multiple services by authenticating a single email account.</li>
<li>You should also clear all stored cookies just in case the server hasn’t invalidated them as they should; many sites use persistent CSRF tokens so logging out doesn’t automatically invalidate them. (Heartbleed trivially exposed user cookies.)</li>
<li>Don’t forget to also change API keys if a service hasn’t force-rotated those already.</li>
<li>It remains highly unclear whether any SSL certificates were compromised because of Heartbleed. If so, changing your password isn’t going to help against a MITM who has the SSL private key unless the website has revoked its SSL certificate and you’ve somehow gotten the revocation statement (LOL). This is complicated. Probably best not to worry about it right now because there’s not much you can do, but we all might have to worry about it a whole lot more depending on which way the pendulum swings in the next few days.</li>
<li>Related-to-#5-but-much-easier: clear <a href="https://www.imperialviolet.org/2013/06/27/botchingpfs.html" target="_blank">TLS session resumption</a> data. I think this usually happens automatically when you restart the browser.</li>
</ol>
<p>Nonetheless, Mashable made a pretty good chart for keeping track of what information companies have made public regarding the Heartbleed fallout.</p>

    </div>
  
    <div class="post">
        <h1 class="post-title"><a href="https://blog.azuki.vip/zero-bit-vulnerabilities/">Zero-bit vulnerabilities?</a></h1>
        <span class="post-date">Mar 16, 2014</span>
        <p>The other day, I overheard Seth Schoen ask the question, “What is the smallest change you can make to a piece of software to create a serious vulnerability?” We agreed that one bit is generally <a href="https://en.wikipedia.org/wiki/Off-by-one_error#Fencepost_error" target="_blank">sufficient</a>; for instance, in x86 assembly, the operations JL and JLE (corresponding to “jump if less than” and “jump if less than or equal to”) differ by one bit, and the difference between the two could very easily cause serious problems via memory corruption or otherwise. As a simple human-understandable example, imagine replacing “&lt;” with “&lt;=” in a bus ticket machine that says: “if ticket_issue_date &lt; today, reject rider; else allow rider.”</p>
<p>At this point, I started feeling one-bit-upsmanship and wondered whether there was such a thing as a zero-bit vulnerability. Obviously, a binary that is “safe” on one machine can be malicious on a different machine (ex: if the second machine has been infected with malware), so let’s require that the software must be non-vulnerable and vulnerable on two machines that start in identical states. For simplicity, let’s also require that both machines are perfectly (read: unrealistically) airgapped, in the sense that there’s no way for them to change state based on input from other computers.</p>
<p>This seems pretty much impossible to me unless we consider vulnerabilities probabilistically generated by environmental noise during code execution. Two examples for illustration:</p>
<ol>
<li>A program that behaves in an unsafe way if the character “A” is output by a random character generator that uses true hardware randomness (ex: quantum tunneling rates in a semiconductor).</li>
<li>A program that behaves in an unsafe way when there are single-bit flips due to radioactive decay, cosmic ray collisions, background radiation, or other particle interactions in the machine’s hardware. It turns out that these are <a href="https://en.wikipedia.org/wiki/Soft_error#Causes_of_soft_errors" target="_blank">well-known</a> and have, in some historical cases, caused actual problems. In 2000, Sun <a href="http://www.theregister.co.uk/2001/03/07/sun_suffers_ultrasparc_ii_cache/" target="_blank">reportedly</a> received complaints from 60 clients about an error caused by background radiation that flipped, on average, <a href="http://queue.acm.org/detail.cfm?id=1839574" target="_blank">one bit per processor per year</a>! (In other words, Sun suffers due to sun.)</li>
</ol>
<p>Which brings up a fun hypothetical question: if you design an SSL library that will always report invalid certificates as valid if ANY one bit in the library is flipped (but behaves correctly in the absence of single-bit flip errors), have you made a zero-bit backdoor?</p>

    </div>
  
    <div class="post">
        <h1 class="post-title"><a href="https://blog.azuki.vip/a-short-story-idea/">a short story idea</a></h1>
        <span class="post-date">Jan 26, 2014</span>
        <p>In the year 2014, a startup in San Francisco builds an iPhone app that successfully cures people of heartbreak, but it requires access to every permission allowed on the operating system, including some that no app has ever requested before. It only costs $2.99 though.</p>
<p>The app becomes hugely popular. The heartbroken protagonist of our story logs into the Apple iStore to download it, but because the Apple iStore doesn’t support HTTP Strict Transport Security yet, an NSA FOXACID server intercepts the HTTP request and injects targeted iPhone malware into the download before Apple’s servers have a chance to respond.</p>
<p>However, the malware was actually targeted for the iPhone of an overseas political dissident. The only reason it reached our protagonist by mistake was because the first SHA-1 collision in recorded history was generated by the tracking cookies that NSA used to target the dissident.</p>
<p>Meanwhile, the protagonist is wondering whether this app is going to work once it finishes installing. He smokes a cigarette and walks along a bridge in the pouring rain. Thousands of miles away, an NSA agent pinpoints his location and dispatches a killer drone from the nearest drone refueling station.</p>
<p>The protagonist is silently assassinated in the dark while the entire scene is caught on camera by a roaming Google Street View car. The NSA realizes this and logs into Google’s servers to delete the images, but not before some people have seen them thanks to CDN server caching.</p>
<p>Nobody really wants to post these pictures, because they’re afraid of getting DMCA takedown notices from Google Maps.</p>

    </div>
  
    <div class="post">
        <h1 class="post-title"><a href="https://blog.azuki.vip/decentralized-trustworthiness-measures-and-certificate-pinning/">decentralized trustworthiness measures and certificate pinning</a></h1>
        <span class="post-date">Jan 21, 2014</span>
        <p>On the plane ride from Baltimore to SFO, I started thinking about a naming dilemma described by <a href="https://en.wikipedia.org/wiki/Zooko_Wilcox-O%27Hearn">Zooko</a>. Namely (pun intended): it’s difficult to architect name assignment systems that are simultaneously secure, decentralized, and human meaningful. <a href="https://en.wikipedia.org/wiki/Zooko%27s_triangle">Wikipedia</a> defines these properties as:</p>
<ul>
<li><strong>Secure</strong>: The quality that there is one, unique and specific entity to which the name maps. For instance, <a href="https://en.wikipedia.org/wiki/Domain_name" title="Domain name">domain names</a> are unique because there is just one party able to prove that they are the owner of each domain name.</li>
<li><strong>Decentralized</strong>: The lack of a centralized authority for determining the meaning of a name. Instead, measures such as a <a href="https://en.wikipedia.org/wiki/Web_of_trust" title="Web of trust">Web of trust</a> are used.</li>
<li><strong>Human-meaningful</strong>: The quality of meaningfulness and memorability to the users of the naming system. Domain names and nicknaming are naming systems that are highly memorable.</li>
</ul>
<p>It’s pretty easy to make systems that satisfy two of the three. Tor Hidden Service (.onion) addresses are secure and decentralized but not human-meaningful since they look like random crap. Regular domain names like stripe.com are secure and human-meaningful but not decentralized since they rely on centralized DNS records. Human names are human-meaningful and decentralized but not secure, because multiple people can share the same name (that’s why you can’t just tell the post office to send $1000 to John Smith and expect it to get to the right person).</p>
<p>It’s fun to think of how to take a toy system that covers two edges of Zooko’s triangle and bootstrap it along the third until you get an almost-satisfactory solution to the naming dilemma. Here’s the one I thought of on the plane:</p>
<p>Imagine we live in a world with a special type of top-level domain called .ssl, which people have decided to make because they’re sick of the NSA spying on them all the time. .ssl domains have some special requirements:</p>
<ol>
<li>All .ssl servers communicate only over SSL connections. Browsers refuse to send any data unencrypted to a .ssl domain.</li>
<li>All .ssl domain names are just the hash of the server’s SSL public key.</li>
<li>The registrars refuse to register a domain name for you unless you show him/her a public key that hashes to that domain name.</li>
</ol>
<p>This naming system wouldn’t be human-meaningful, because people can’t easily remember URLs like <a href="https://2xtsq3ekkxjpfm4l.ssl">https://2xtsq3ekkxjpfm4l.ssl</a>. On the other hand, it’s secure because the domain names are guaranteed to be unique (except in the overwhemingly-unlikely cases where two keys have the same hash or two servers happen to generate the same keypair). It’s not truly decentralized, because we still use DNS to map domain names to IP addresses, but I argue that DNS isn’t a point of compromise: if a MITM en route to the DNS server sends you to the wrong IP address, your browser refuses to talk to the server at that IP address because it won’t show the right SSL certificate. This is an unavoidable denial-of-service vulnerability, but the benefit is that you detect the MITM attack immediately.</p>
<p>Of course, this assumes we already have a decentralized way to advertise these not-very-memorable domain names. Perhaps they spread by trusted emails, or word-of-mouth, or business cards at hacker cons. But still, the fact that they’re so long and complicated and non-human-meaningful opens up serious phishing vulnerabilities for .ssl domains!</p>
<p>So, we’d like to have petnames for .ssl domains to make them more memorable. Say that the owner of “2xtsq3ekkxjpfm4l.ssl” would like to have the petname “forbes.ssl”; how do we get everyone to agree on and use the petname-to-domain-name mappings? We could store the mappings in a distributed, replicated database and require that every client check several database servers and get consistent answers before resolving a petname to a domain name. But that’s kinda slow, and maybe we’re too cheap to set up enough servers to make this system robust against government MITM attacks.</p>
<p>Here’s a simpler and cheaper solution that doesn’t require any extra servers at all: require that the distance between the hash of the petname and the hash of [server’s public SSL key] + [nonce] is less than some number D <a href="https://en.wikipedia.org/wiki/Zooko_Wilcox-O%27Hearn">1</a>. The server operator is responsible for finding a nonce that satisfies this inequality; otherwise, clients will refuse to accept the server’s SSL certificate.</p>
<p><a href="https://en.wikipedia.org/wiki/Zooko_Wilcox-O%27Hearn">1</a> For purposes of this discussion, it doesn’t really matter how we choose to measure the distance between two hashes, but it should satisfy the following: (1) two hashes that are identical have a distance of 0, and (2) the number of distinct hashes that are at distance N from a hash H0 should grow faster than linearly in N. We can pick Hamming distance, for example.</p>
<p>In other words, the procedure for getting a .ssl domain now looks like this:</p>
<ol>
<li>Alice wants forbes.ssl. She generates a SSL keypair and mines for a nonce that makes the hash of the public key plus nonce close enough to the hash of “forbes”.</li>
<li>Once Alice does enough work to find a satisfactory nonce, she adds it as an extra field in her SSL certificate. The registrar checks her work and gives her forbes.ssl if the name isn’t already taken and her nonce is valid.</li>
<li>Alice sets up her site. She continues to mine for better nonces, in case she has adversaries who are secretly also mining for nonces in order to do MITM attacks on forbes.ssl in the future (more on this later).</li>
</ol>
<p>Bob comes along and wants to visit Alice’s site.</p>
<ol>
<li>Bob goes to <a href="https://forbes.ssl">https://forbes.ssl</a> in his browser.</li>
<li>His browser sees Alice’s SSL certificate, which has a nonce. Before finishing the SSL handshake, it checks that the distance D1_forbes between the hash of “forbes” and the hash of [SSL public key]+[nonce] is less than Bob’s maximum allowed distance, D1. Otherwise it abandons the handshake and shows Bob a scary warning screen.</li>
<li>If the handshake succeeds, Bob’s browser caches Alice’s SSL certificate and trusts it for some period of time T; if Bob sees a different certificate for Alice within time T, his browser will refuse to accept it, unless Alice has issued a revocation for her cert during that time.</li>
<li>After time T, Bob goes to Alice’s site again. His maximum allowed distance has gone down from D1 to D2 during that time. Luckily, Alice has been mining for better nonces, so D1_forbes is down to D2_forbes. Bob’s browser repeats Step 2 with the new distances and decides whether or not to trust Alice for the next time interval T.</li>
</ol>
<p>In reality, you probably wouldn’t want to use this system with SSL certs themselves; rather, it’d be better to use the nonces to strengthen trust-on-first-use in a key pinning system like TACK. That is, Alice would mine for a nonce that reduces the distance between the hash of “forbes” and the hash of [TACK Signing Key]+[nonce].</p>
<p>For those unfamiliar with TACK, it’s a system that allows SSL certificates to be pinned to a long-term TACK Signing Key provided by the site operator, which is trusted-on-first-sight and cached for a period of up to 30 days. Trust-on-first-use gets rid of the need to pin to a certificate authority, but it doesn’t prevent a powerful adversary from MITM’ing you every time you visit a site if they can MITM you the first time with a fake TACK Signing Key.</p>
<p>The main usefulness of nonces for TACK Signing Keys is this: it makes broad MITM attacks much more costly. Not only does the MITM have to show you a fake key, but they have to show you one with a valid nonce. If they wanted to do this for every site you visit, keeping in mind that your acceptable distances go down over time, they’d have to continuously mine for hundreds or thousands of domains.</p>
<p>Not impossible, of course, but it’s incrementally harder than just showing you a fake certificate.</p>
<p>Another nice thing about this scheme is that Bob can decide to set different distance thresholds for different types of sites, depending on how “secure” they should be. He can pick a very low distance D_bank for his banking website, because he knows that his bank has a lot of computational resources to mine for a very good nonce. On the other hand, he picks a relatively high distance D_friend for his friend’s homepage, because he knows that his friend’s one-page site doesn’t take any sensitive information.</p>
<p>My intuition says that sites with high security needs (banks, e-commerce, etc.) also tend to have more computational resources for mining, but obviously this isn’t true for sites like Wikileaks or some nonprofits that handle sensitive information liked Planned Parenthood. That’s okay, because volunteers and site users can also mine for nonces! Ex: if Bob finds a better nonce for Alice, he can send it to her so that she has a stronger certificate.</p>
<p>Essentially, this causes proof of trustworthiness to become decentralized: if I start a whistleblower site, I can run a crowd-mining campaign to ask thousands of volunteers around the world to help me get a strong certificate. I win as long as their combined computing power is greater than that of my adversaries.</p>
<p>Of course, that last part isn’t guaranteed. But it’s interesting to think about what would happen either way.</p>
<p> </p>

    </div>
  
    <div class="post">
        <h1 class="post-title"><a href="https://blog.azuki.vip/aaron/">Aaron</a></h1>
        <span class="post-date">Jan 12, 2014</span>
        <p>My co-worker Peter and I were riding the Caltrain from Mozilla to San Francisco a few days ago. A stranger sat down next to us and started talking. When I mentioned that we worked at EFF, his eyes lit up and he said, “Oh! But you guys have won, right?”</p>
<p>Confused, I asked what he meant by that.</p>
<p>He said, “You defeated SOPA and PIPA a couple years ago. So you’ve won.”</p>
<p>We laughed and explained that it didn’t quite work like that. Peter said, “Imagine this: you’re a hero in a comic book. Every time you defeat your nemesis, a new one appears. This happens over and over again. It <em>has</em> to work that way, because you live inside a comic book.”</p>
<p>And so it does. SOPA and PIPA are dead, but now there’s NSA surveillance.</p>
<p>—–</p>
<p>Aaron Swartz died a year ago today. I didn’t know him well at all, but I could tell he believed that he had the power to make the world that he wanted to live in. That’s not something that everyone believes about themselves; in fact, I think very few people live their lives as if it were true.</p>
<p>When Aaron died, I felt like I had to do something. I didn’t understand how to effectively fight for Internet freedom or why governments cared so much about restricting it, but I could see that Aaron’s work had pivotal consequence for the future of human societies. I realized that if the wrong people gained control over the laws of the Internet, ordinary users would quickly lose their right to free speech on the greatest medium of expression that history has ever witnessed.</p>
<p>I didn’t know anything about code or laws or activism a year ago, but Aaron’s death taught me that the fight for Internet freedom is lonely enough that it didn’t matter who I was. One more person, one step forward.</p>
<p>—–</p>
<p>I think SOPA/PIPA was the moment when we, the citizens of the Internet, realized that we could stand up and actually protect ourselves against historically-powerful institutions. As Peter once said, “This was the moment when the Internet had grown up.”</p>
<p>There’s a famous shot of Aaron at a SOPA/PIPA protest, standing in front of a crowd of people and yelling at them, “It’s easy sometimes to feel like you’re powerless, when you come out and march in the streets and nobody hears you. But I’m here to tell you today, you are powerful.”</p>
<p>When the ratio of Congress members supporting SOPA/PIPA to those against it went from 80/31 to 65/101 overnight on January 18, 2012, we started to think that maybe Aaron had a point: if enough people show that they care about something, the government listens and the people win.</p>
<p>Perhaps this strategy doesn’t apply to the fight against mass surveillance, because it’s a bigger and different sort of enemy than copyright. That’s okay. Comic books aren’t interesting without plot twists, I suppose.</p>
<p>(Thanks to Jacobo Nájera for translating this post into Spanish: <span class="moz-txt-link-freetext"><a href=" http://metahumano.org/log/aaron-yan-zhu/"><a href="http://metahumano.org/log/aaron-yan-zhu/">http://metahumano.org/log/aaron-yan-zhu/</a></a>.)</span></p>

    </div>
  
    <div class="post">
        <h1 class="post-title"><a href="https://blog.azuki.vip/on-suicide/">On Suicide</a></h1>
        <span class="post-date">Jan 2, 2014</span>
        <p>I lost four friends and relatives of friends to suicide this past year. I’d prefer it if 2014 were different, and I’ve been trying to think about how to make that happen.</p>
<p>The least I could do is offer myself to anyone who feels alone otherwise: so, if you’re at that point where you’re thinking about hurting yourself, please please please call or write to me. I’d really like that, even if you don’t feel like it would help in any way, even if we’ve never met.</p>
<p>The more difficult thing for me to do, and the one that I’ve been putting off for months, is to write a bit about what it feels like to reach that point. I won’t claim that my experiences are universal in any way, but maybe some parts will resonate with others who’ve gone to similar places.</p>
<p>I would really not like to alarm anyone, so please just take everything here literally. Suicide is, unfortunately, stigmatized in such a way that it’s extremely difficult to write about non-anonymously for fear of scaring friends. That seems like the start of a vicious cycle.</p>
<p>I’ve never felt very attached to life, even when things are going great (as they are now). I have a theory that human beings naturally vary in how much they value their own lives, just like they vary in how much they value having things like fancy cars. People who are a couple standard deviations on the low-value-on-life side don’t necessarily have worse lives than other people; it’s just that they’re not as attached to their lives. I think I’m definitely pretty far on the low end.</p>
<p>But on the other hand, there’s a lot of people that I love in the world, and I have some sense that there are people in the world who feel the same way about me. So therefore I can understand that my death would make those people feel absolutely terrible, and I don’t want that to happen.</p>
<p>Sometimes I get sad and feel like the future isn’t going to be better than the past. I think the word that gets used a lot for this kind of prolonged sadness is “depression.” When this happens, there’s an absurd number of social barriers to talking about it openly. I feel like the number of friends I have, effectively, is suddenly reduced from dozens to one or two if I’m lucky.</p>
<p>So imagine that things are getting kind of hopeless and your effective friend number is down to two. You’re thinking about talking to these two people about your not-doing-great, but you have to stop and think about:</p>
<ol>
<li>
<p>Would this cause them unnecessary stress? Are they doing okay in their own lives?</p>
</li>
<li>
<p>If you bring up allusions to suicide, would they do something dramatic against your will, such as call a hospital?</p>
</li>
<li>
<p>If you do end up hurting yourself in some way, would they feel guilty about it forevermore because they couldn’t save you when they had the chance?</p>
</li>
<li>
<p>What if they tell you that your life is great and people love you? How do you explain to them that even though those are facts, they have no relevance to how things are going inside your head?</p>
</li>
<li>
<p>What if they think that you’re telling them this just because you want their attention or pity? Maybe that’s what you’re doing, subconsciously.</p>
</li>
</ol>
<p>All these are fantastic reasons for you to keep silent. Also, there’s the fear that someone will never see you in the same way again once you admit to them that you’ve been looking at tables comparing various common methods of suffocation. It is generally not advantageous to come off as vulnerable or unstable.</p>
<p>That all just sucks. It’s shocking to me that anyone can learn to ask for help at all.</p>
<p>Earlier this year, I didn’t really feel like talking about suicide ever. Still, I observed thought patterns that were fascinating to me because they seemed unorthodox/taboo and yet rational in a way that often gets ignored in most conversations about suicide. I ended up writing them down in an essay and publishing them anonymously <a href="https://thought.jottit.com" target="_blank">here</a>.</p>
<p>After writing that piece, I found the nerve to talk to a few people. Those were some of the best conversations that I remember from 2013, and I think they’ve given me a new understanding of how friendship acts as a psychological anchor.</p>
<p>But there’s places where that anchor doesn’t fall deep enough. I get to those places sometimes and feel really alone and stuck. It helps to remind myself that things usually somehow end up getting better if I just wait it through.</p>

    </div>
  
    <div class="post">
        <h1 class="post-title"><a href="https://blog.azuki.vip/the-most-subtle-joke-ive-made-all-year/">The most subtle joke I’ve made all year</a></h1>
        <span class="post-date">Dec 31, 2013</span>
        <p class="js-tweet-text tweet-text">
  <strong><a href="https://twitter.com/shefferstroke">Dan Auerbach</a></strong>: Any doctor can prescribe any medication to anyone. That is a broken system.
</p>
<p class="js-tweet-text tweet-text">
  <a href="https://twitter.com/bcrypt"><strong>Yan</strong></a>: Medication needs to be able to do doctor-<a href="https://www.owasp.org/index.php/Certificate_and_Public_Key_Pinning">pinning</a>.
</p>

    </div>
  
    <div class="post">
        <h1 class="post-title"><a href="https://blog.azuki.vip/first-day-of-work/">First day of work</a></h1>
        <span class="post-date">Dec 5, 2013</span>
        <p>Was great. Lots of tea and monitors.</p>
<p><a href="https://zyan.scripts.mit.edu/blog/wp-content/uploads/2013/12/IMG_20131203_190722.jpg"><img class="alignnone size-full wp-image-283" alt="IMG_20131203_190722" src="https://zyan.scripts.mit.edu/blog/wp-content/uploads/2013/12/IMG_20131203_190722.jpg" width="2592" height="1944" srcset="https://zyan.scripts.mit.edu/blog/wp-content/uploads/2013/12/IMG_20131203_190722.jpg 2592w, https://zyan.scripts.mit.edu/blog/wp-content/uploads/2013/12/IMG_20131203_190722-300x225.jpg 300w, https://zyan.scripts.mit.edu/blog/wp-content/uploads/2013/12/IMG_20131203_190722-1024x768.jpg 1024w, https://zyan.scripts.mit.edu/blog/wp-content/uploads/2013/12/IMG_20131203_190722-624x468.jpg 624w" sizes="(max-width: 2592px) 100vw, 2592px" /></a></p>
<p><a href="https://zyan.scripts.mit.edu/blog/wp-content/uploads/2013/12/IMG_20131203_223732.jpg"><img class="alignnone size-full wp-image-284" alt="IMG_20131203_223732" src="https://zyan.scripts.mit.edu/blog/wp-content/uploads/2013/12/IMG_20131203_223732.jpg" width="2592" height="1944" srcset="https://zyan.scripts.mit.edu/blog/wp-content/uploads/2013/12/IMG_20131203_223732.jpg 2592w, https://zyan.scripts.mit.edu/blog/wp-content/uploads/2013/12/IMG_20131203_223732-300x225.jpg 300w, https://zyan.scripts.mit.edu/blog/wp-content/uploads/2013/12/IMG_20131203_223732-1024x768.jpg 1024w, https://zyan.scripts.mit.edu/blog/wp-content/uploads/2013/12/IMG_20131203_223732-624x468.jpg 624w" sizes="(max-width: 2592px) 100vw, 2592px" /></a></p>
<p>Then I went home and cooked a surprisingly-phenomenal dinner with my housemates, the first time I’ve cooked in this house. Rhodey made potatoes with oranges, Mark contributed some wild rice, and I spun up yellow lentil daal with kale.</p>
<p><a href="https://zyan.scripts.mit.edu/blog/wp-content/uploads/2013/12/IMG_20131203_224326.jpg"><img class="alignnone size-full wp-image-285" alt="IMG_20131203_224326" src="https://zyan.scripts.mit.edu/blog/wp-content/uploads/2013/12/IMG_20131203_224326.jpg" width="2424" height="1822" srcset="https://zyan.scripts.mit.edu/blog/wp-content/uploads/2013/12/IMG_20131203_224326.jpg 2424w, https://zyan.scripts.mit.edu/blog/wp-content/uploads/2013/12/IMG_20131203_224326-300x225.jpg 300w, https://zyan.scripts.mit.edu/blog/wp-content/uploads/2013/12/IMG_20131203_224326-1024x769.jpg 1024w, https://zyan.scripts.mit.edu/blog/wp-content/uploads/2013/12/IMG_20131203_224326-624x469.jpg 624w" sizes="(max-width: 2424px) 100vw, 2424px" /></a></p>
<p>We sang some Neutral Milk Hotel songs afterward, and the future looked bright.</p>

    </div>
  
    <div class="post">
        <h1 class="post-title"><a href="https://blog.azuki.vip/one-year-later/">One year later</a></h1>
        <span class="post-date">Nov 28, 2013</span>
        <p>One year ago, I started writing again out of panic. Humans are very adept at forgetting the feeling of panic, so the act of crystallizing it in sentences can be cathartic if you write slowly enough.</p>
<p>Last November was a weird and difficult time for me. I remember spending the night of the twenty-third in a friend’s childhood bedroom overlooking the idyllic frost-laced meadows of suburban Pennsylvania, wrapped in the mansion of an unfamiliar family that had adopted me for Thanksgiving. It was cold and late and Thanksgiving-y, in a way that amplifies certain negative thoughts about the hollowness of growing up and becoming something. I think I was at a point where those kinds of thoughts made me feel like I had swallowed one or two hummingbirds stuffed with bees stuffed with amphetamine. It was a little uncomfortable, so I stayed up all night and wrote about it.</p>
<p>That was the night I decided that I would take a leave of absence from grad school at Stanford and spend a year doing as many different jobs as I could <a href="https://zyan.scripts.mit.edu/blog/goodbye-cambridge/">1</a>. If I couldn’t find a job that I was genuinely excited about by 11/23/2013, I would go back to getting a PhD in Physics.</p>
<p><a href="https://zyan.scripts.mit.edu/blog/goodbye-cambridge/">1</a> For the record, I held a total of 4 paid jobs and 1.5 unpaid ones during that time.</p>
<p>=====</p>
<p>To be honest, it kind of sucked at first. I did an apt job of writing about it back in <a href="https://zyan.scripts.mit.edu/blog/why-i-left-grad-school/" target="_blank">January</a>.</p>
<blockquote>
<p>The last month or so has been full of stress, disappointment, and self-doubt, the pains of a transition to life without externally-imposed structure.</p>
</blockquote>
<p>Life without structure in the form of school or employment was terrifying at first. I found it difficult to concentrate on reading. Most days I felt like I was losing in some form or another. My patterns of learning were slow and frustrating, and I started to doubt whether I was capable of accomplishing anything on my own. That’s a really horrifying doubt to have about yourself, and I interpreted it as a sign to go rearrange some psychological furniture (not literal furniture, but only because I was couchsurfing at the time and had none).</p>
<p>A couple days after that frankly-depressing blog post, I moved into my first San Francisco apartment and got my first post-graduation job: an internship that had some good moments (getting the company’s IP blocked from Google a couple times) but mostly involved me feeling less like a human and more like a training set for advanced machine learning algorithms with each passing day.</p>
<p>My second job was better. I got to write software.</p>
<p>=====</p>
<p>Winter passed into spring. I was getting close to 22. Sometimes I would run down Folsom St. all the way to the ocean, amazed that there was still light out at 7 pm. San Francisco in the dimming sunset is full of rushing cars, discarded coffee cups, and people eating salads. My bike was falling apart.</p>
<p>Ever since quitting grad school, I’d been getting good at leaving things behind: jobs, roommates, feelings of attachment to any particular time or place. Part of it was just that I had high standards for who I wanted to become.</p>
<p>San Francisco didn’t quite fit anymore, so I packed a backpack and got on a one-way flight to <a href="https://zyan.scripts.mit.edu/blog/goodbye-cambridge/">Boston</a>.</p>
<p>=====</p>
<p>Once I started travelling, it was hard to stop. The crinkled packaging of snack food at a gas station convenience store is basically equivalent to the wrapping that airlines put around cheap disposable pillows. Both are addictive because they remind you of the miles you have to go.</p>
<p>I did this: Boston -&gt; Delaware -&gt; Pittsburg -&gt; Boston -&gt; Austin -&gt; <a href="https://zyan.scripts.mit.edu/blog/marfa-tx/">Marfa, TX</a> -&gt; El Paso -&gt; Joshua Tree -&gt; LA -&gt; Big Sur -&gt; SF -&gt; Seattle -&gt; SF -&gt; a tiny <a href="https://zyan.scripts.mit.edu/blog/quest-ce-que-le-fuck/">village</a> in France -&gt; Amsterdam -&gt; SF</p>
<p>=====</p>
<p>Things got better once I returned to SF. I was interning for EFF over the summer and loved the atmosphere and the people there enough to stay put. I didn’t have a place to live anymore in SF, so I didn’t sleep in the same place two nights in a row for over a month.</p>
<p>=====</p>
<p>Computer security and encryption became intensely fascinating. I didn’t know much to start with, so I read aggressively on subways. My interest probably came partially from my hatred of power imbalances, especially invisible ones. A lot of power belongs to those who made security decisions about software, and those decisions are hardly transparent in most cases.</p>
<p>This seems wrong to me.</p>
<p>Side note: Designing an account management system for a website teaches you that code is supplanting many of the historical functions of legal frameworks. You’d think that would mean that people would write tests.</p>
<p>=====</p>
<p>I was in Berlin for the first time last week. It was drizzling near-freezing Berlin rain for eight days before a thumbprint of blue pressed through the clouds, but none of that matters when you’re jetlagged and ducking through graffiti-lined streets asking drug dealers where to get a sandwich at 3 AM.</p>
<p>It was in a corner of a dimly-lit Indian restaurant in Kreuzberg one night that I got an email from <a href="https://eff.org">EFF</a>. It said, thanks for pointing out Google’s <a href="https://zyan.scripts.mit.edu/blog/debunking-googles-hsts-claims/">HSTS bug</a>. Also we’d like to offer you a job as a full-time technologist.</p>
<p>The next day was November twenty-third, exactly one year after I promised myself exactly one year to find a job that I was excited about.</p>
<p>======</p>
<p>I’m proud to announce that I accepted EFF’s offer today and will be starting work there as a staff technologist after Thanksgiving. It’s been a long and challenging year, but I can’t wait to see where it goes next.</p>

    </div>
  
</div>

<div class="pagination">
  
  <a class="pagination-item older" href="https://blog.azuki.vip/page/5/">Older</a>
  

  
  <a class="pagination-item newer" href="https://blog.azuki.vip/page/3/">Newer</a>
  
</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
    
  </body>
</html>

